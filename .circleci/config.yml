version: 2.1

jobs:
  build:
    docker:
      - image: silex/emacs:27.1
    working_directory: /kubel
    steps:
      - run: apt update && apt install -y git ssh make
      - checkout
      - run:
          name: Install packages
          command: |
            emacs -Q --batch -l .circleci/make.el --funcall make-install-packages

      - run:
          name: ERT tests
          command: |
            emacs -Q --batch -l .circleci/make.el --funcall make-ert

      - run:
          name: Compile
          command: |
            emacs -Q --batch -l .circleci/make.el --funcall make-compile kubel.el

      - run:
          name: Lint
          command: |
            emacs -Q --batch -l .circleci/make.el --funcall make-lint kubel.el
